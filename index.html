<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<style>

  #app {
    display: flex;
    flex-direction: row;
    justify-content: space-around;
    padding: 2%;
  }

  .nav {
    width: 27%;
  }

  .mainBlock {
    width: 67%;
    padding: 0 1%;
    display: flex;
    flex-direction: column;
  }

  .searchBlock {
    width: 100%;
    height: 50px;
    display: flex;
    flex-direction: row;
    justify-content: flex-end;
  }

  .inputBtn, .searchBlock input {
    height: 20px;
  }

  .inputBtn {
    width: 60%;
  }

  .searchBlock input {
    width: 70%;
  }

  .btn {
    width: 24%;
    height: 26px;
  }

  .txtMainBlock {
    width: 30%;
    display: flex;
    justify-content: flex-end;
  }

  .content {
    width: 100%;
    min-height: 350px;
    border: 1px solid black;
    border-radius: 3px;
    font-size: 50px;
    text-transform: uppercase;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .content div {
    text-align: center;
  }

  .linkBlock {
    width: 100%;
    margin-top: 10px;
    border-radius: 3px;
  }

  ul {
    padding: 0;
    margin: 0;
  }

  ul li {
    list-style: none;
    width: 100%;
    height: 30px;
    border: 1px solid black;
    border-radius: 3px;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  ul li:hover {
    cursor: pointer;
    background-color: rgb(69, 38, 219, 0.3);
    transition: all 0.2s ease-out;
  }

  h4 {
    margin: 5px 10px;
  }

  .content .entities li {
    margin-top: 10px;
    border: none;
    font-size: 20px;
  }

  .hiddenBlock ol:last-child {
    margin-bottom: 20px;
  }

  @media screen and (min-width:535px) and (max-width:917px) {
    .txtMainBlock {
      font-size: 2.2vw;
      margin-left: 3vw;
    }

    .tabs, .linkBlock {
      font-size: 2.3vw;
    }
  }

  @media screen and (max-width:535px) {
    #app {
      flex-direction: column;
    }

    .nav, .mainBlock, .inputBtn {
      width: 100%;
    }

    .mainBlock {
      padding: 10px 0;
    }

    .searchBlock input {
      width: 70%;
    }

    .inputBtn {
      margin-top: 10px;
    }

    .searchBlock {
      flex-direction: column-reverse;
      align-items: center;
      margin: 20px 0;
    }

    .txtMainBlock {
      width: auto;
    }

    .tabs, .linkBlock, .txtMainBlock {
      font-size: 3.5vw;
    }
  }


</style>
<body>
  <div id="app">

    <div class="nav">
      <ul class="tabs" @click="choiseFilm">
        <li v-for="film in films">{{ film.title }}</li>
        <li v-for="attribute in attributes"></li>
      </ul>
    </div>

    <div class="mainBlock">

      <div class="searchBlock">
        <form class="inputBtn" @submit.prevent="submit">
          <input type="text" v-model="description">
          <button type="submit" name="button" class="btn" :disabled="!valid"  @click="clianerName"> Поиск </button>
        </form>
        <div class="txtMainBlock" v-html="message"></div>
      </div>

      <div class="content" :style="cleanFilm || nameFilm || allFilm || allObj ? {background: 'linear-gradient' + '(' + 90 + 'deg, #c' + 380 + 'cc' + ' ' + 0 + '%, #' + 386 + 'aee ' + 90.48 + '%)'} : {background: 'white'}" @click="showIt">
        <div class="" v-bind="filmTitle">{{ cleanFilm }}</div>
        <div class="">
          <ul class="entities">
            <li v-for="allFilm in allFilms">{{ allFilm.title }}</li>
          </ul>
        </div>
        <div class="">
          <ul class="entities">
            <li v-for="allObj in allObjs">{{ allObj.name }}</li>
          </ul>
        </div>
        <div v-html="nameFilm">{{ nameFilm }}</div>
      </div>

      <div class="linkBlock" :style="{border: 1 + 'px' + ' solid black'}">
        <div>
          <h4>CHARACTERS&#58;</h4>
          <ul class="hiddenBlock">
            <ol v-for="hero in heroes">
              <a href="#">{{ hero }}</a>
            </ol>
          </ul>

          <h4>STARSHIPS&#58;</h4>
          <ul class="hiddenBlock">
            <ol v-for="ship in ships">
              <a href="#">{{ ship }}</a>
            </ol>
          </ul>

          <h4>PLANETS&#58;</h4>
          <ul class="hiddenBlock">
            <ol v-for="planet in planets">
              <a href="#">{{ planet }}</a>
            </ol>
          </ul>
        </div>
      </div>
    </div>
  </div>



<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
<script type="module">
  import Vue from 'https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.esm.browser.js'
</script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>

  var app = new Vue({
    el: '#app',

    data: {
      message: 'Введите общий запрос',
      description: '',
      attributes: ['', '', '', '', '', '', '', ''],
      films: [],
      peoples: [],
      peoplesList: [],
      people: '',
      starships: [],
      starship: '',
      allplanets: [],
      allplanet: '',
      url: {
        films: 'https://swapi.dev/api/films',
        planets: 'https://swapi.dev/api/planets',
        peoples: 'https://swapi.dev/api/people',
        starships: 'https://swapi.dev/api/starships'
      },
      filmTitle: '',
      filmTitles: [],
      allFilms: [],
      allObjs: [],
      addFilm: '',
      nameFilms: [],
      nameFilm: '',
      cleanFilm: '',
      allFilm: '',
      allObj: '',
      parent: '',
      target: '',
      e: '',
      heroes: [],
      hero: '',
      ships: [],
      ship: '',
      planets: [],
      planet: '',
      newName: ''
    },

    created: function () {

      axios.get(this.url.films).then((response) => {
        console.log(response.data.results);
        this.films = response.data.results;
      });
    },

    mounted() {

      if (localStorage.cleanFilm) {
        newName = localStorage.cleanFilm,
        console.log(newName);
      };

      if (localStorage.getItem('allObjs')) {
        try {
          newName2 = JSON.parse(localStorage.getItem('allObjs'));
          console.log(newName2);
        } catch(e) {
          this.allObjs.removeItem('allObjs');
        }
      };

      if (localStorage.getItem('allFilm')) {
        try {
          newName3 = JSON.parse(localStorage.getItem('allFilm'));
          console.log(newName3);
        } catch(e) {
          this.allFilm.removeItem('allFilm');
        }
      };
    },

    watch: {

      cleanFilm(newName) {
        localStorage.cleanFilm = newName,
        console.log(newName);
      }
    },

    methods: {

      saveInfo: function() {
      const parsed = JSON.stringify(this.allObjs);
      const parsed2 = JSON.stringify(this.allFilm);
      localStorage.setItem('allObjs', parsed);
      localStorage.setItem('allFilm', parsed2);
      console.log(parsed);
      console.log(parsed2);
    },

      submit: function() {
        const filmTitle = {
          description: this.description.trim(),
          id: Date.now().toString()
        }
        this.description = '',
        this.addFilm = this.filmTitles.push(filmTitle),
        console.log(this.filmTitles)
      },

      clianerName: function() {
        this.saveInfo();

        this.message = 'Сущности:',
        this.nameFilm = '',
        this.peoples = [],
        this.starships = [],
        this.allplanets = [],
        this.allObjs = [],
        this.heroes = [];
        this.ships = [];
        this.planets = [];

        if(this.description === 'film' || this.description === 'films' || this.description === 'фильм' ||this.description === 'фильмы') {
          axios.get(this.url.films).then((response) => {
            console.log(response.data.results);
            this.allFilms = response.data.results;
            this.cleanFilm = '';
            this.allObj = '';
            this.allFilm = response.data.results;
          });
          } if(this.description === 'planet' || this.description === 'planets' || this.description === 'планета' ||this.description === 'планеты') {
            axios.get(this.url.planets).then((response) => {
              console.log(response.data.results);
              this.allObjs = response.data.results;
              this.cleanFilm = '';
              this.allFilm = '';
              this.allObj = response.data.results;
            });
            } if(this.description === 'people' || this.description === 'peoples' || this.description === 'персона' ||this.description === 'персоны') {
              axios.get(this.url.peoples).then((response) => {
                console.log(response.data.results);
                this.allObjs = response.data.results;
                this.cleanFilm = '';
                this.allFilm = '';
                this.allObj = response.data.results;
              });
              } if(this.description === 'starship' || this.description === 'starships' || this.description === 'корабль' ||this.description === 'корабли') {
                axios.get(this.url.starships).then((response) => {
                  console.log(response.data.results);
                  this.allObjs = response.data.results;
                  this.cleanFilm = '';
                  this.allFilm = '';
                  this.allObj = response.data.results;
                });
                } else (
                  this.allFilms = '',
                  this.allObjs = '',
                  this.cleanFilm = this.description)
      },

      choiseFilm: function(event) {
        this.message = 'Название фильма и ссылки его на сущности:';
        this.heroes = [];
        this.ships = [];
        this.planets = [];

        axios.get(this.url.films).then((response) => {
          this.cleanFilm = '';
          this.allFilms = '';
          this.allObjs = '';

          this.parent = document.getElementsByClassName("tabs")[0];
          this.e = event;
          this.target = event.target;
          for (i = -1; i < this.parent.children.length; i++) {
            if(this.parent.children[i] == this.target) {
              return console.log(response.data.results[i].title),
              this.nameFilm = response.data.results[i].title,
              this.peoples = response.data.results[i].characters,
              this.starships = response.data.results[i].starships,
              this.allplanets = response.data.results[i].planets,
              console.log(this.peoples),
              console.log(this.nameFilm),
              console.log(this.starships),
              console.log(this.allplanets);
            } else (this.nameFilm = '',
            this.peoples = '',
            this.starships = '',
            this.allplanets = '');
          };
        });
      },

      showIt: function() {
        this.heroes = [];
        this.ships = [];
        this.planets = [];

        for (n = 0; n < this.peoples.length; n++) {
          axios.get(this.peoples[n]).then((response) => {
            this.heroes += response.data.name + ',',
            this.heroes = this.heroes.split(','),
            console.log(this.heroes);
          })
        };

        for (n = 0; n < this.starships.length; n++) {
          axios.get(this.starships[n]).then((response) => {
            this.ships += response.data.name + ',',
            this.ships = this.ships.split(','),
            console.log(this.ships);
          })
        };

        for (n = 0; n < this.allplanets.length; n++) {
          axios.get(this.allplanets[n]).then((response) => {
            this.planets += response.data.name + ',',
            this.planets = this.planets.split(','),
            console.log(this.planets);
          })
        };
      }

    },

    computed: {
      valid: function() {
        return this.description.trim()
      }
    }
  })

</script>


</body>
</html>
